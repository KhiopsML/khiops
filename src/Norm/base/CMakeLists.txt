# On utilise les exceptions seulement pour le fichier Regex.cpp
if(NOT MSVC)
  set_source_files_properties(Regexp.cpp PROPERTIES COMPILE_FLAGS -fexceptions)
endif(NOT MSVC)

# The files generated by Lex& Yacc are available on base sources directory : JSONLex.inc
#
# It is possible to regenerate them (when the *.lex or *.yac files are modified) with the option BUILD_LEX_YACC the
# generated files are located on the build tree and the legacy ones are not used(and not modified).
if(BUILD_LEX_YACC)
  bison_target(JSONParser JSONYac.yac ${CMAKE_CURRENT_SOURCE_DIR}/JSONYac.cpp)
  if(MSVC)
    flex_target(JSONScanner JSONLex.lex JSONLex.inc COMPILE_FLAGS "--nounistd")
  else()
    flex_target(JSONScanner JSONLex.lex JSONLex.inc)
  endif(MSVC)
  add_flex_bison_dependency(JSONScanner JSONParser)
else()
  # We defined the Bison / Flex generated files with the files already present
  set(BISON_JSONParser_OUTPUTS ${CMAKE_CURRENT_SOURCE_DIR}/JSONYac.cpp)
  set(FLEX_JSONScanner_OUTPUTS ${CMAKE_CURRENT_SOURCE_DIR}/JSONLex.inc)
endif()

# The outputs of Bison /Flex are managed separately from the list of standard cpp files
file(GLOB cppfiles ${CMAKE_CURRENT_SOURCE_DIR}/*.cpp)
list(REMOVE_ITEM cppfiles ${BISON_JSONParser_OUTPUTS} ${FLEX_JSONScanner_OUTPUTS})

add_library(base STATIC ${cppfiles} ${BISON_JSONParser_OUTPUTS} ${FLEX_JSONScanner_OUTPUTS})

set_khiops_options(base)

target_include_directories(base PUBLIC ${CMAKE_CURRENT_SOURCE_DIR})
if(NOT MSVC)
  target_link_libraries(base PUBLIC ${CMAKE_DL_LIBS})
endif(NOT MSVC)
